@using SecondHand.Models.ViewModels;
@using System.Globalization;
@model CartVM
@{
    Layout = "_Layout";
}

<section class="uk-section uk-section-small">
    <div class="uk-container">
        <div class="uk-grid-medium uk-child-width-1-1" uk-grid>
            <section class="uk-text-center">
                <a class="uk-link-muted "
                   asp-action="Index">
                    <span class="uk-margin-xsmall-right"
                          uk-icon="icon: arrow-left; ratio: .75;"></span>Trở lại giỏ hàng
                </a>
                <h1 class="uk-margin-small-top uk-margin-remove-bottom">
                    Thanh Toán
                </h1>
            </section>
            <section>
                <div class="uk-grid-medium" uk-grid>
                    <form class="uk-form-stacked uk-width-1-1 tm-checkout uk-width-expand@m">
                        <div class="uk-grid-medium uk-child-width-1-1"
                             uk-grid>
                            <section>
                                <h2 class="tm-checkout-title">
                                    Thông tin khách hàng
                                </h2>
                                <div class="uk-card uk-card-default uk-card-small uk-card-body tm-ignore-container uk-margin-top uk-margin-bottom">
                                    <div class="uk-grid-small uk-child-width-1-1 uk-child-width-1-2@s"
                                         uk-grid>
                                        <div>
                                            <label>
                                                <div class="uk-form-label uk-form-label-required">
                                                    Họ và tên
                                                </div>
                                                <input asp-for="Order.Name" class="uk-input" type="text" />
                                                       
                                            </label>
                                        </div>
                                       
                                        <div style="margin-top: 5px;">
                                            <label>
                                                <div class="uk-form-label uk-form-label-required">
                                                    Số Điện Thoại
                                                </div>
                                                <input asp-for ="Order.PhoneNumber" class="uk-input"
                                                       type="tel"
                                                       required />
                                            </label>
                                        </div>
                                        <div>
                                            <label>
                                                <div class="uk-form-label uk-form-label-required">
                                                    Email
                                                </div>
                                                <input asp-for="Order.User.Email" class="uk-input"
                                                       type="email"
                                                       required />
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </section>
                            <section>
                                <h2 class="tm-checkout-title">
                                    Địa chỉ giao hàng
                                </h2>
                                <div class="uk-card uk-card-default uk-card-small uk-card-body tm-ignore-container uk-margin-top uk-margin-bottom">
                                    
                                    <div class="uk-margin"> 
                                        <section>
                                            <div class="uk-grid-small uk-child-width-1-1" uk-grid>
                                                
                                                <div>
                                                    <label>
                                                        <div class="uk-form-label uk-form-label-required">
                                                            Địa chỉ
                                                        </div>
                                                        <div class="uk-form-controls">
                                                        <input asp-for="Order.Address" class="uk-input"
                                                               type="text" />
                                                        </div>
                                                    </label>
                                                </div>
                                               
                                            </div>
                                            <div class="uk-grid-small uk-child-width-1-3 uk-child-width-1-3@s"
                                                 uk-grid>
                                                <div>
                                                    <label>
                                                        <div class="uk-form-label uk-form-label-required">
                                                            Thành phố
                                                        </div>
                                                        <select asp-for="Order.City" id="citySelect" class="uk-select">
                                                            <option value="">Chọn thành phố</option>
                                                        </select>
                                                    </label>
                                                </div>
                                                <div>
                                                    <label>
                                                        <div class="uk-form-label uk-form-label-required">
                                                            Quận/Huyện
                                                        </div>
                                                        <select asp-for="Order.State" id="districtSelect" class="uk-select">
                                                            <option value="">Chọn quận/huyện</option>
                                                        </select>
                                                    </label>
                                                </div>  
                                                <div>
                                                    <label>
                                                        <div class="uk-form-label">
                                                            Phường/Xã
                                                        </div>
                                                        <select asp-for="Order.Ward" id="wardSelect" class="uk-select">
                                                            <option value="">Chọn phường/xã</option>
                                                        </select>
                                                    </label>
                                                </div>
                                                <div class="uk-form-group uk-margin-top">
                                                    <label>
                                                        <div class="uk-form-label">
                                                            Ghi chú
                                                        </div>
                                                    </label>
                                                        <div>
                                                            <textarea asp-for="Order.Note" class="uk-textarea uk-child-width-1-1 uk-form-control"
                                                                  rows="5"
                                                                  placeholder="Note cho cửa hàng"></textarea>
                                                         </div>
                                                    
                                                </div>
                                            </div>
                                           
                                        </section>
                                    </div>
                                </div>
                            </section>
                            <section>
                                <h2 class="tm-checkout-title">
                                    Phương thức trả tiền
                                </h2>
                                <div class="uk-card uk-card-default uk-card-small tm-ignore-container uk-margin-top uk-margin-bottom">
                                    <div class="uk-card-body">
                                        <div class="uk-grid-small uk-grid-match uk-child-width-1-1 uk-child-width-1-3@s uk-flex-center"
                                             uk-switcher="toggle: &gt; * &gt; .tm-choose"
                                             uk-grid>
                                            <div>
                                                <a class="tm-choose"
                                                   href="#">
                                                    <div class="tm-choose-title">
                                                        Trả tiền
                                                        khi
                                                        nhận hàng
                                                    </div>
                                                    
                                                </a>
                                            </div>
                                            <div>
                                                <a class="tm-choose"
                                                   href="#">
                                                    <div class="tm-choose-title">
                                                        Thẻ trực tuyến
                                                    </div>
                                                    <div class="tm-choose-description">
                                                        Visa,
                                                        MasterCard
                                                    </div>
                                                </a>
                                            </div>
                                            <div>
                                                <a class="tm-choose"
                                                   href="#">
                                                    <div class="tm-choose-title">
                                                        Thanh toán
                                                        điện tử
                                                    </div>
                                                    <div class="tm-choose-description">
                                                        MoMo
                                                    </div>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="uk-card-footer">
                                        <div class="uk-grid-small uk-flex-middle uk-flex-center uk-text-center"
                                             uk-grid>
                                            <div class="uk-text-meta">
                                                <span class="uk-margin-xsmall-right"
                                                      uk-icon="icon: lock; ratio: .75;"></span>An ninh
                                                trong việc
                                                thanh toán
                                                được đảm bảo bởi
                                                các giao thức bảo mật
                                            </div>
                                            <div>
                                                <img src="images/verified-by-visa.svg"
                                                     title="Verified by Visa"
                                                     style="
                                                                        height: 25px;
                                                                    " />
                                            </div>
                                            <div>
                                                <img src="images/mastercard-securecode.svg"
                                                     title="MasterCard SecureCode"
                                                     style="
                                                                        height: 25px;
                                                                    " />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </form>
                    <div class="uk-width-1-1 uk-width-1-4@m tm-aside-column">
                        <div class="uk-card uk-card-default uk-card-small tm-ignore-container"
                             uk-sticky="offset: 30; bottom: true;">
                            <section class="uk-card-body">
                                <h4>Sản phẩm đã đặt</h4>
                                @foreach(var details in Model.ListCart)
                                {
                                    <div class="uk-grid-small"
                                         uk-grid>
                                        <div class="uk-width-expand">
                                            <div class="uk-text-small">
                                               @details.Product.Name
                                            </div>
                                            <div class="uk-text-meta">
                                               @details.count × @details.Product.Price.ToString("C", CultureInfo.GetCultureInfo("vi-VN")).Replace(" ", "").Replace(".", ",")
                                            </div>
                                        </div>
                                        <div class="uk-text-right">
                                            <div>@details.Product.Price.ToString("C", CultureInfo.GetCultureInfo("vi-VN")).Replace(" ", "").Replace(".", ",")</div>
                                        </div>
                                    </div>
                                }
                              
                            </section>
                            <section class="uk-card-body">
                                <div class="uk-grid-small"
                                     uk-grid>
                                    <div class="uk-width-expand">
                                        <div class="uk-text-muted">
                                            Tạm Tổng Tính
                                        </div>
                                    </div>
                                    <div class="uk-text-right">
                                        <div>@(((decimal)Model.Order.Total).ToString("C", CultureInfo.GetCultureInfo("vi-VN")).Replace(" ", "").Replace(".", ","))</div>
                                    </div>
                                </div>
                                <div class="uk-grid-small"
                                     uk-grid>
                                    <div class="uk-width-expand">
                                        <div class="uk-text-muted">
                                            Giảm giá
                                        </div>
                                    </div>
                                    <div class="uk-text-right">
                                        <div class="uk-text-danger">
                                            −$0
                                        </div>
                                    </div>
                                </div>
                            </section>
                            <section class="uk-card-body">
                                <div class="uk-grid-small uk-flex-middle"
                                     uk-grid>
                                    <div class="uk-width-expand">
                                        <div class="uk-text-muted">
                                            Tổng Tiền
                                        </div>
                                    </div>
                                    <div class="uk-text-right">
                                        <div class="uk-text-lead uk-text-bolder">
                                            @(((decimal)Model.Order.Total).ToString("C", CultureInfo.GetCultureInfo("vi-VN")).Replace(" ", "").Replace(".", ","))
                                        </div>
                                    </div>
                                </div>
                                <button class="uk-button uk-button-primary uk-margin-small uk-width-1-1">
                                    Đặt hàng
                                </button>
                            </section>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</section>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        // Đặt Token API của GHN
        var apiToken = '11bc5038-6046-11ee-a59f-a260851ba65c';

        // Lấy danh sách Tỉnh/Thành phố từ API và cập nhật trường select #citySelect
        $.ajax({
            url: 'https://online-gateway.ghn.vn/shiip/public-api/master-data/province',
            type: 'GET',
            headers: {
                'Token': apiToken
            },
            success: function (data) {
                var citySelect = $('#citySelect');
                citySelect.empty();
                citySelect.append($('<option>', {
                    value: '',
                    text: 'Chọn thành phố'
                }));
                $.each(data.data, function (i, city) {
                    citySelect.append($('<option>', {
                        value: city.ProvinceID,
                        text: city.ProvinceName
                    }));
                });
            }
        });

        // Bắt sự kiện khi người dùng chọn thành phố và cập nhật danh sách Quận/Huyện
        $('#citySelect').on('change', function () {
            var selectedCityId = $(this).val();

            if (selectedCityId) {
                $.ajax({
                    url: 'https://online-gateway.ghn.vn/shiip/public-api/master-data/district',
                    type: 'GET',
                    headers: {
                        'Token': apiToken
                    },
                    data: {
                        province_id: selectedCityId
                    },
                    success: function (data) {
                        var districtSelect = $('#districtSelect');
                        districtSelect.empty();
                        districtSelect.append($('<option>', {
                            value: '',
                            text: 'Chọn quận/huyện'
                        }));
                        $.each(data.data, function (i, district) {
                            districtSelect.append($('<option>', {
                                value: district.DistrictID,
                                text: district.DistrictName
                            }));
                        });
                    }
                });
            }
        });

        // Bắt sự kiện khi người dùng chọn Quận/Huyện và cập nhật danh sách Phường/Xã
        $('#districtSelect').on('change', function () {
            var selectedDistrictId = $(this).val();

            if (selectedDistrictId) {
                $.ajax({
                    url: 'https://online-gateway.ghn.vn/shiip/public-api/master-data/ward',
                    type: 'GET',
                    headers: {
                        'Token': apiToken
                    },
                    data: {
                        district_id: selectedDistrictId
                    },
                    success: function (data) {
                        var wardSelect = $('#wardSelect');
                        wardSelect.empty();
                        wardSelect.append($('<option>', {
                            value: '',
                            text: 'Chọn phường/xã'
                        }));
                        $.each(data.data, function (i, ward) {
                            wardSelect.append($('<option>', {
                                value: ward.WardCode,
                                text: ward.WardName
                            }));
                        });
                    }
                });
            }
        });
    });
</script>

